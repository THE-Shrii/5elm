<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5 ELM - Coming Soon</title>
 <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Halant:wght@300;400;500;600;700&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="content">
    <div class="logo">
      <img src="assets/img/l2.png" alt="5 ELM Logo" />
    </div>

    <h1>Coming soon...</h1>
    <p>
      Born from the five elements, our products are an ode to nature‚Äôs purity and timeless Ayurvedic rituals.
      We‚Äôre creating skincare that feels personal, conscious, and deeply connected.
      We‚Äôd love for you to begin this journey with us.
    </p>

    <p>
      Be the first to experience 5 ELM.<br />
      Sign up to get exclusive early access and <span class="span1">enjoy 10% off</span> your first <br> order.
    </p>

   <form id="landing-form">
  <div class="form-group">
    <label for="firstName">FIRST NAME</label>
    <input type="text" id="firstName" placeholder="ENTER FIRST NAME *" required />
    <div class="error-message" id="firstName-error"></div>
  </div>

  <div class="form-group">
    <label for="lastName">LAST NAME</label>
    <input type="text" id="lastName" placeholder="ENTER LAST NAME *" required />
    <div class="error-message" id="lastName-error"></div>
  </div>

  <div class="form-group">
    <label for="email">EMAIL ADDRESS</label>
    <input type="email" id="email" placeholder="ENTER YOUR EMAIL *" required />
    <div class="error-message" id="email-error"></div>
  </div>

  <div class="form-group">
    <label for="phone">CONTACT NO</label>
    <input type="tel" id="phone" placeholder="ENTER CONTACT NUMBER" />
    <div class="error-message" id="phone-error"></div>
  </div>

  <div class="checkbox">
    <input type="checkbox" id="consent" />
    <label for="consent" class="ag1">
      I agree to receive marketing newsletters, offers, and other promotional communications.
    </label>
  </div>

  <button type="submit">Sign Up</button>
  <p id="form-message" style="margin-top: 10px; font-size: 0.8rem;"></p>
</form>

  </div>
  <script>
// üß† Global Modal State Management
let isModalOpen = false;

// üß† Validation Functions
function validateEmail(email) {
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailPattern.test(email);
}

function validatePhone(phone) {
  if (!phone) return true; // Optional field
  const phonePattern = /^[6-9]\d{9}$/;
  return phonePattern.test(phone);
}

function validateName(name) {
  const namePattern = /^[a-zA-Z\s\-]+$/;
  return namePattern.test(name);
}

function showFieldError(fieldId, message) {
  const field = document.getElementById(fieldId);
  const errorDiv = document.getElementById(`${fieldId}-error`);
  
  field.style.borderColor = '#ff6b6b';
  errorDiv.textContent = message;
  errorDiv.style.display = 'block';
}

function clearFieldError(fieldId) {
  const field = document.getElementById(fieldId);
  const errorDiv = document.getElementById(`${fieldId}-error`);
  
  field.style.borderColor = '#ccc';
  errorDiv.textContent = '';
  errorDiv.style.display = 'none';
}

function clearAllErrors() {
  ['firstName', 'lastName', 'email', 'phone'].forEach(clearFieldError);
}

function showModal(title, message, isError = false) {
  console.log('üéâ showModal called:', title); // Debug log
  
  // Prevent multiple modals
  if (isModalOpen) {
    console.log('üõë Modal already open, ignoring request');
    return;
  }
  
  const modal = document.getElementById('response-modal');
  const modalTitle = document.getElementById('modal-title');
  const modalMessage = document.getElementById('modal-message');
  const modalIcon = document.getElementById('modal-icon');
  
  if (modal && modalTitle && modalMessage && modalIcon) {
    modalTitle.textContent = title;
    modalMessage.textContent = message;
    modalIcon.textContent = isError ? '‚ùå' : '‚úÖ';
    modalIcon.style.color = isError ? '#ff6b6b' : '#555C4A';
    
    modal.style.display = 'flex';
    isModalOpen = true; // Set flag to prevent conflicts
    console.log('üéâ Modal displayed successfully'); // Debug log
  } else {
    console.error('‚ùå Modal elements not found!');
  }
}

function closeModal() {
  console.log('üîí Modal close function called'); // Debug log
  
  if (!isModalOpen) {
    console.log('üõë Modal already closed, ignoring request');
    return;
  }
  
  const modal = document.getElementById('response-modal');
  if (modal) {
    modal.style.display = 'none';
    isModalOpen = false; // Reset flag
    console.log('üîí Modal closed successfully'); // Debug log
  }
}

document.getElementById("landing-form").addEventListener("submit", async function (e) {
  e.preventDefault();

  // Clear previous errors
  clearAllErrors();

  const firstName = document.getElementById("firstName").value.trim();
  const lastName = document.getElementById("lastName").value.trim();
  const email = document.getElementById("email").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const consent = document.getElementById("consent").checked;

  const submitBtn = e.target.querySelector("button");
  let hasErrors = false;

  // üéØ Frontend Validation
  if (!firstName) {
    showFieldError('firstName', 'First name is required.');
    hasErrors = true;
  } else if (!validateName(firstName)) {
    showFieldError('firstName', 'First name can only contain letters, spaces, and hyphens.');
    hasErrors = true;
  }

  if (!lastName) {
    showFieldError('lastName', 'Last name is required.');
    hasErrors = true;
  } else if (!validateName(lastName)) {
    showFieldError('lastName', 'Last name can only contain letters, spaces, and hyphens.');
    hasErrors = true;
  }

  if (!email) {
    showFieldError('email', 'Email address is required.');
    hasErrors = true;
  } else if (!validateEmail(email)) {
    showFieldError('email', 'Please enter a valid email address.');
    hasErrors = true;
  }

  if (phone && !validatePhone(phone)) {
    showFieldError('phone', 'Please enter a valid 10-digit phone number starting with 6-9.');
    hasErrors = true;
  }

  if (hasErrors) return;

  const payload = { firstName, lastName, email, phone, consent };

  try {
    submitBtn.disabled = true;
    submitBtn.textContent = "Submitting...";

    const response = await fetch("http://localhost:5000/api/v1/landing/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });

    const data = await response.json();

    if (response.ok && data.success) {
      // üéâ Show success modal
      showModal(
        'Registration Successful!',
        `Thank you, ${firstName}! You've successfully registered. Check your inbox for your exclusive 10% off coupon!`
      );
      
      // Reset form
      e.target.reset();
      clearAllErrors();
    } else {
      // üö® Show error modal
      showModal(
        'Registration Failed',
        data.message || 'Something went wrong. Please try again.',
        true
      );
    }
  } catch (error) {
    console.error("Error submitting form:", error);
    showModal(
      'Server Error',
      'Server error, please try again later.',
      true
    );
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = "Sign Up";
  }
});

// Setup modal close functionality - only close on button click
document.addEventListener('DOMContentLoaded', function() {
  console.log('üîß Setting up modal close functionality');
  const closeBtn = document.getElementById("close-response-modal");
  
  if (closeBtn) {
    // Remove any existing listeners to prevent duplicates
    closeBtn.removeEventListener("click", closeModal);
    
    // Add the close event listener ONLY ONCE
    closeBtn.addEventListener("click", function(e) {
      console.log('üéØ Close button clicked!');
      e.preventDefault();
      e.stopPropagation();
      closeModal();
    });
    
    console.log('‚úÖ Modal close listener attached successfully');
  } else {
    console.error('‚ùå Close button not found!');
  }
  
  // Prevent any accidental modal closing
  const modal = document.getElementById('response-modal');
  if (modal) {
    // Remove all click events on modal background
    modal.onclick = null;
    modal.addEventListener('click', function(e) {
      e.stopPropagation();
      console.log('üõ°Ô∏è Modal background clicked - but not closing!');
    });
  }
});
</script>

<!-- ‚úÖ Response Modal (Success/Error) -->
<div id="response-modal" class="modal-overlay" style="display:none;">
  <div class="modal-box">
    <div class="modal-icon" id="modal-icon">‚úÖ</div>
    <h2 id="modal-title">Registration Successful!</h2>
    <p id="modal-message">Thank you for signing up! Check your email for your exclusive coupon.</p>
    <button id="close-response-modal" class="modal-button">Got It</button>
  </div>
</div>

<style>
  /* Error Message Styling */
  .error-message {
    display: none;
    color: #ff6b6b;
    font-size: 0.75rem;
    margin-top: 4px;
    font-weight: 500;
  }

  .form-group input.error {
    border-color: #ff6b6b !important;
    box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.1);
  }

  /* Modal Styling - Persistent Modal (only closes on button click) */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    backdrop-filter: blur(6px);
    cursor: default; /* Indicate this area is not clickable */
  }

  .modal-box {
    background: linear-gradient(135deg, #fefefe 0%, #f8f6f3 100%);
    color: #333;
    padding: 2.5rem;
    border-radius: 20px;
    text-align: center;
    width: 90%;
    max-width: 420px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border: 1px solid #e8e5e0;
    font-family: 'Poppins', sans-serif;
    transform: scale(0.9);
    animation: modalAppear 0.3s ease-out forwards;
    pointer-events: auto; /* Ensure modal content is clickable */
  }

  @keyframes modalAppear {
    to {
      transform: scale(1);
    }
  }

  .modal-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    display: block;
  }

  .modal-box h2 {
    margin-bottom: 1rem;
    color: #555C4A;
    font-size: 1.5rem;
    font-weight: 600;
  }

  .modal-box p {
    margin-bottom: 1.5rem;
    color: #666;
    line-height: 1.5;
    font-size: 0.95rem;
  }

  .modal-button {
    padding: 0.75rem 2rem;
    border: none;
    border-radius: 12px;
    background: linear-gradient(135deg, #555C4A 0%, #6b7559 100%);
    color: #fff;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(85, 92, 74, 0.3);
    animation: buttonPulse 2s infinite;
    position: relative;
  }

  @keyframes buttonPulse {
    0%, 100% {
      box-shadow: 0 4px 12px rgba(85, 92, 74, 0.3);
    }
    50% {
      box-shadow: 0 4px 12px rgba(85, 92, 74, 0.6), 0 0 0 4px rgba(85, 92, 74, 0.1);
    }
  }

  .modal-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(85, 92, 74, 0.4);
    background: linear-gradient(135deg, #6b7559 0%, #555C4A 100%);
    animation: none; /* Stop pulsing on hover */
  }

  .modal-button:active {
    transform: translateY(0);
    animation: none;
  }

  /* Form Input Enhanced Styling */
  .form-group input {
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }

  .form-group input:focus {
    border-color: #555C4A;
    box-shadow: 0 0 0 2px rgba(85, 92, 74, 0.1);
    outline: none;
  }

  /* Remove old popup styles if they exist */
  .popup-overlay {
    display: none !important;
  }
</style>

</body>
</html>
